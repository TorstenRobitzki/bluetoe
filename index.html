<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BlueToe: Bluetoe</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="customdoxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="Logo_Bluetoe.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BlueToe
   </div>
   <div id="projectbrief">an alternative GATT/BLE implementation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Bluetoe </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro_sec"></a>
Introduction</h1>
<p >Bluetoe is an attempt to simplify the implementation of firmware for Bluetooth Low Energy devices. Bluetooth Low Energy devices / peripherals implement a so called GATT Server. GATT is the abreviation of Generic Attribute Profile. GATT is a protocol that allows a computer (desktop, phone etc.) to discover remote devices capabilities and to interact with this devices in an unified manner.</p>
<p >A lot of possible device capabilities are specified by the <a href="https://www.bluetooth.org">Bluetooth Special Interest Group</a>. Others capabilities are user defined and make sense only to the implementer of a device and requires a special client that knows how to use this capabilities. Those capabilities and the means how to access them are called profiles.</p>
<h1><a class="anchor" id="gatt_basics"></a>
GATT Basics</h1>
<h2><a class="anchor" id="Characteristics"></a>
Characteristics</h2>
<p >The basic building blocks of GATT are characteristics. A <a class="el" href="classbluetoe_1_1characteristic.html">characteristic </a> can be thinked of as a piece of information / a variable that resides inside of a device, which clients can interact with (discover, reading, writing). To identify a characteristic, an identifier, called a UUID is used. Beside some very basic properties like "readable" or "writeable", a characteristic can have additional properties like a name or structure informations (e.g. this is a structure containing 1 float followed by 2 integers).</p>
<h2><a class="anchor" id="Services"></a>
Services</h2>
<p >A <a class="el" href="classbluetoe_1_1service.html">service </a> groups characteristics to meaningful units. A helicopter position service would for example group the X, Y, and Z position of the helicopter to a Position Service. A device can announce the implementation / existance of a service by that device, so that computers looking for a specific device can see that the device is implementing the service, without the need to connect to the device.</p>
<h2><a class="anchor" id="Profiles"></a>
Profiles</h2>
<p >A profile groups <a class="el" href="index.html#Services">Services</a> to higher level functionality and is usually "just" a document that describes what a device must implement to be conforming to a certain profile and how client should interact with services.</p>
<h2><a class="anchor" id="UUIDs"></a>
UUIDs</h2>
<p >Both, <a class="el" href="index.html#Characteristics">Characteristics</a> and <a class="el" href="index.html#Services">Services</a> are identified by Universally Unique Identifiers (<a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a>). Bluetooth Low Energy basically uses two different kinds of UUIDs, one 16 bit long, the other 128 bit long.</p>
<p >16-bit UUIDs are exclusivly assigned by the <a href="https://www.bluetooth.org">Bluetooth Special Interest Group</a>. 128-bit UUIDs can be generated by anyone and used in custom applications that are not standardised.</p>
<p >16-bit UUIDs are usually notated as a 4 digit hexadecimal number. 128-bit UUIDs are grouped in packs of different size. Example: 7A5F69F4-3915-41C7-92BD-1477B35B883D.</p>
<h2><a class="anchor" id="ATT"></a>
ATT</h2>
<p >GATT is implemented on top of ATT (Attribute Protocol). GATT basecally defines how characteristics and services are mapped to attributes and how GATT procedures are mapped to ATT procedures to access the characteristics and services. A GATT server defines all its services and characterstics with one, single table of attributes.</p>
<p >An attribute is a tuple, containing a handle, a type, and a value. Where a handle is a 16 bit integer, which is some kind of unique key into an attribute table. The type denoted by a UUID and is either 16 bit or 128 bit long. UUIDs within the attribute table are not unique. Finally, data is a variable length data field, that can be read and / or written.</p>
<p >ATT not only defines this attribute table, but also how to access this table. While GATT procedures are the means of how to access the characteristics of a service, what is actually spoken on air (and thus observable or debuggable) is ATT. But this mapping of GATT procedures to ATT procedures is quit leightweigt and easy to understand and intuitive.</p>
<h1><a class="anchor" id="start_bluetoe"></a>
Bluetoe's Implementation of GATT</h1>
<p >Bluetoe let you define a list of GATT services on your own, let you define the characteristics within each service and how accesses to a characteristic are mapped to C++ function calls (or global variables accesses, or constants beeing reads).</p>
<h2><a class="anchor" id="Characteristic"></a>
Characteristic</h2>
<p >Bluetoe uses the C++ type system to collect all data / information that is already available at compile time from the developer. So, the definition of a characteristic is a type; A template class called <a class="el" href="classbluetoe_1_1characteristic.html">bluetoe::characteristic</a> which takes a list of parameters that defines how exactly a characteristic should work. Template classes that take a variable list of parameters are often used within Bluetoe and in most cases, the order of the parameters are not important. Here is a minimalistic example:</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> io_pin_access_characteristic =</div>
<div class="line">    <a class="code hl_class" href="classbluetoe_1_1characteristic.html">bluetoe::characteristic</a>&lt;</div>
<div class="line">        <a class="code hl_struct" href="structbluetoe_1_1characteristic__uuid.html">bluetoe::characteristic_uuid&lt; 0x43809849, 0x0025, 0x4529, 0xA50F, 0x48C362742282 &gt;</a>,</div>
<div class="line">        <a class="code hl_struct" href="structbluetoe_1_1free__write__handler.html">bluetoe::free_write_handler&lt; bool, io_pin_write_handler &gt;</a></div>
<div class="line">    &gt;;</div>
<div class="ttc" id="aclassbluetoe_1_1characteristic_html"><div class="ttname"><a href="classbluetoe_1_1characteristic.html">bluetoe::characteristic</a></div><div class="ttdoc">A characteristic is a typed value that is accessable by a GATT client hosted by a GATT server.</div><div class="ttdef"><b>Definition:</b> characteristic.hpp:160</div></div>
<div class="ttc" id="astructbluetoe_1_1characteristic__uuid_html"><div class="ttname"><a href="structbluetoe_1_1characteristic__uuid.html">bluetoe::characteristic_uuid</a></div><div class="ttdoc">a 128-Bit UUID used to identify a characteristic.</div><div class="ttdef"><b>Definition:</b> characteristic.hpp:62</div></div>
<div class="ttc" id="astructbluetoe_1_1free__write__handler_html"><div class="ttname"><a href="structbluetoe_1_1free__write__handler.html">bluetoe::free_write_handler</a></div><div class="ttdoc">binds a free function as a write handler for the given characteristic</div><div class="ttdef"><b>Definition:</b> characteristic_value.hpp:1248</div></div>
</div><!-- fragment --><p >The type definition above, defines a characteristic which is identifed by the 128 bit UUID 43809849-0025-4529-A50F-48C362742282 and defines, which free function have to be called, in case that there is any write attempt to the characteristic.</p>
<p >By omitting a definition of how to read the characteristic, bluetoe assumes that the characteristic is write-only. Any attempt to read the characteristic will be responded with an error.</p>
<p >Furthermore, by defing bool, to be the type, that is taken by the write handler (io_pin_write_handler()), Bluetoe will generate error responses to every attempt to write othere values that are not a single byte containing the value 1 or 0.</p>
<p >So the signature of io_pin_write_handler() looks like this:</p>
<div class="fragment"><div class="line">std::uint8_t io_pin_write_handler( <span class="keywordtype">bool</span> state );</div>
</div><!-- fragment --><p >The return values allows the handler to return errors, in case the requested write caused any error.</p>
<p >And that's all, Bluetoe needs to know to implement the access of the write-only characteristic that accepts only boolean values. Bluetoe will use this information to generate the necessary attributes in the ATT attribute table, to handle the very basic error cases and to map the characteristic access to a specific handler. No need to define handles, no need to define characteristic attributes, nor characteristic descriptors.</p>
<p >This shows some of the key design decisions, made for Bluetoe:</p><ul>
<li>No need to provide redundant information: No need to specify characteristic attributes, which is done implicit by the defined read and write handlers. No need to assigned handles or define descriptors, which is done by the library.</li>
<li>Safe and resonable defaults are used: By narrowing down, the accepted range of values, by defining the type of stored information, Bluetoe can handle already a lot of malicious write attempts that do not fit to the underlying data type.</li>
<li>Find as much bugs as possible at compile time: For example: defining a characteristic, that has neither a read handler, nor a write handler defined, will result in a compile time error.</li>
<li>Make easy things easy: There should not be any need to read the bluetooth core specification before being able to read and understand the libraries documentation and there concepts.</li>
</ul>
<p >Here is a second example of a characteristic definition:</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> temperature_characteristic =</div>
<div class="line">    <a class="code hl_class" href="classbluetoe_1_1characteristic.html">bluetoe::characteristic</a>&lt;</div>
<div class="line">        <a class="code hl_struct" href="structbluetoe_1_1characteristic__uuid.html">bluetoe::characteristic_uuid&lt; 0x8C8B4094, 0x0DE2, 0x499F, 0xA28A, 0x4EED5BC73CA9 &gt;</a>,</div>
<div class="line">        <a class="code hl_class" href="classbluetoe_1_1bind__characteristic__value.html">bluetoe::bind_characteristic_value</a>&lt; <span class="keyword">decltype</span>( temperature ), &amp;temperature &gt;,</div>
<div class="line">        <a class="code hl_struct" href="structbluetoe_1_1no__write__access.html">bluetoe::no_write_access</a></div>
<div class="line">    &gt;;</div>
<div class="ttc" id="aclassbluetoe_1_1bind__characteristic__value_html"><div class="ttname"><a href="classbluetoe_1_1bind__characteristic__value.html">bluetoe::bind_characteristic_value</a></div><div class="ttdoc">a very simple device to bind a characteristic to a global variable to provide access to the character...</div><div class="ttdef"><b>Definition:</b> characteristic_value.hpp:254</div></div>
<div class="ttc" id="astructbluetoe_1_1no__write__access_html"><div class="ttname"><a href="structbluetoe_1_1no__write__access.html">bluetoe::no_write_access</a></div><div class="ttdoc">if added as option to a characteristic, write access is removed from the characteristic</div><div class="ttdef"><b>Definition:</b> characteristic_value.hpp:69</div></div>
</div><!-- fragment --><p >This time, accessing the characteristic, is mapped to a global variable named temperature, by using the <a class="el" href="classbluetoe_1_1bind__characteristic__value.html">bluetoe::bind_characteristic_value</a> template, that takes a variable type and the address of a variable.</p>
<p >This would make Bluetoe to generate code that allows to read and write the characteristic value, as long as the size of the data written has the size of the given type. By adding the type <a class="el" href="structbluetoe_1_1no__write__access.html">bluetoe::no_write_access</a> parameter, Bluetoe will remove the write access to the characteristic and will respond with an error code to every attempt to write to the characteristic.</p>
<p >There are a lot more types that defines the binding to characteristic values.</p>
<h2><a class="anchor" id="Service"></a>
Service</h2>
<p >Roughly saying, a <a class="el" href="classbluetoe_1_1service.html">bluetoe::service</a> is just an UUID with a list of characteristics! So this example should make sense to you:</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> temperature_and_io_pin_service =</div>
<div class="line">    <a class="code hl_class" href="classbluetoe_1_1service.html">bluetoe::service</a>&lt;</div>
<div class="line">        <a class="code hl_class" href="classbluetoe_1_1service__uuid.html">bluetoe::service_uuid&lt; 0xC11169E1, 0x6252, 0x4450, 0x931C, 0x1B43A318783B &gt;</a>,</div>
<div class="line">        io_pin_access_characteristic,</div>
<div class="line">        temperature_characteristic</div>
<div class="line">    &gt;;</div>
<div class="ttc" id="aclassbluetoe_1_1service__uuid_html"><div class="ttname"><a href="classbluetoe_1_1service__uuid.html">bluetoe::service_uuid</a></div><div class="ttdoc">a 128-Bit UUID used to identify a service.</div><div class="ttdef"><b>Definition:</b> service.hpp:57</div></div>
<div class="ttc" id="aclassbluetoe_1_1service_html"><div class="ttname"><a href="classbluetoe_1_1service.html">bluetoe::service</a></div><div class="ttdoc">a service with zero or more characteristics</div><div class="ttdef"><b>Definition:</b> service.hpp:150</div></div>
</div><!-- fragment --><p >This service somehow combines the reading of a temperatur and the setting of an IO pin. Maybe the IO pin is connected to an actor, that can open or close a window and thus influence the temperature.</p>
<h2><a class="anchor" id="Server"></a>
Server</h2>
<p >Finally a <a class="el" href="classbluetoe_1_1server.html">bluetoe::server</a> combines all <a class="el" href="classbluetoe_1_1service.html">bluetoe::service</a> to implement a GATT server:</p>
<div class="fragment"><div class="line"><span class="keyword">using</span> gatt_server =</div>
<div class="line">    <a class="code hl_class" href="classbluetoe_1_1server.html">bluetoe::server</a>&lt;</div>
<div class="line">       temperature_and_io_pin_service</div>
<div class="line">    &gt;;</div>
<div class="ttc" id="aclassbluetoe_1_1server_html"><div class="ttname"><a href="classbluetoe_1_1server.html">bluetoe::server</a></div><div class="ttdoc">Root of the declaration of a GATT server.</div><div class="ttdef"><b>Definition:</b> server.hpp:63</div></div>
</div><!-- fragment --><p >This is a very minimalistic example. A more sophisticated example would take serveral services and would give the server a name and such details. Bluetoe already applies a lot of defaults. A <a class="el" href="structbluetoe_1_1gap__service__for__gatt__servers.html">bluetoe::gap_service_for_gatt_servers</a> is added by default to the server.</p>
<h1><a class="anchor" id="hardware_binding"></a>
Binding to Hardware</h1>
<p >Up to now, there is no actual hardware involved. To deploy a defined GATT server to specific hardware, a so called binding is used, that takes the <a class="el" href="classbluetoe_1_1server.html">bluetoe::server</a> instance as parameter. Here an example that uses a nrf52 from Nordic as target hardware:</p>
<div class="fragment"><div class="line"><a class="code hl_typedef" href="nrf52_8hpp.html#a494ce89968171ec5603fb785266aeb03">bluetoe::nrf52&lt; gatt_server &gt;</a> server;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> ( ;; )</div>
<div class="line">        server.run();</div>
<div class="line">}</div>
<div class="ttc" id="anrf52_8hpp_html_a494ce89968171ec5603fb785266aeb03"><div class="ttname"><a href="nrf52_8hpp.html#a494ce89968171ec5603fb785266aeb03">bluetoe::nrf52</a></div><div class="ttdeci">typename nrf52_details::link_layer_factory&lt; Server, details::requires_encryption_support_t&lt; Server &gt;::value, typename nrf52_details::radio_options&lt; Options... &gt;::result, typename nrf52_details::link_layer_options&lt; Options... &gt;::result &gt;::link_layer nrf52</div><div class="ttdoc">binding for nRF52 microcontrollers</div><div class="ttdef"><b>Definition:</b> nrf52.hpp:845</div></div>
</div><!-- fragment --><p >bluetoe::nrf52&lt;&gt; is just a template alias that points to <a class="el" href="classbluetoe_1_1link__layer_1_1link__layer.html" title="link layer implementation">bluetoe::link_layer::link_layer</a>, which takes additonal link layer configuration arguments. Again, Bluetoe applies resonable default to the link layer configuration. But if needed, parameters like buffer sizes, are configurable.</p>
<h1><a class="anchor" id="define_gap"></a>
And what's with GAP?</h1>
<h1><a class="anchor" id="Advertising"></a>
Advertising</h1>
<p >GAP is an other important protocol that allows a GATT client to discover devices, connect to them and to gather basic informations about a device. In Bluetooth all possible options related to GAP are passed as options to the <a class="el" href="classbluetoe_1_1server.html">bluetoe::server</a> type definition.</p>
<p >A Bluetoe GATT server will start to advertise by default and will restart to advertise after a client have disconnected to the server. Bluetoe will advertise the implemented services by default. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Apr 5 2022 17:22:39 for BlueToe by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
